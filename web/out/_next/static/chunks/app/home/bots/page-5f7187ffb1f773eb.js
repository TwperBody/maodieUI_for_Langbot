(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[719],{1947:e=>{e.exports={botLogListContainer:"botLog_botLogListContainer__M_RAw",botLogCardContainer:"botLog_botLogCardContainer__jPxQh",listHeader:"botLog_listHeader__P1B5c",tag:"botLog_tag__evYY1",chatTag:"botLog_chatTag__0FbI3",chatId:"botLog_chatId__gdFg7",cardTitleContainer:"botLog_cardTitleContainer__s9VnW",cardText:"botLog_cardText__97tJL"}},2552:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var s=a(5155),n=a(2115),i=a(3393),o=a.n(i);class r{constructor(e){this.id=e.id,this.iconURL=e.iconURL,this.name=e.name,this.description=e.description,this.adapter=e.adapter,this.adapterConfig=e.adapterConfig,this.adapterLabel=e.adapterLabel,this.usePipelineName=e.usePipelineName,this.enable=e.enable}}var c=a(5045),l=a.n(c),d=a(9120),h=a(333),p=a(1218),u=a(6671);function m(e){let{botCardVO:t,setBotEnableCallback:a}=e,{t:n}=(0,p.Bd)();return(0,s.jsx)("div",{className:"".concat(l().cardContainer),children:(0,s.jsxs)("div",{className:"".concat(l().iconBasicInfoContainer),children:[(0,s.jsx)("img",{className:"".concat(l().iconImage),src:t.iconURL,alt:"icon"}),(0,s.jsxs)("div",{className:"".concat(l().basicInfoContainer),children:[(0,s.jsxs)("div",{className:"".concat(l().basicInfoNameContainer),children:[(0,s.jsx)("div",{className:"".concat(l().basicInfoName),children:t.name}),(0,s.jsx)("div",{className:"".concat(l().basicInfoDescription),children:t.description})]}),(0,s.jsxs)("div",{className:"".concat(l().basicInfoAdapterContainer),children:[(0,s.jsx)("svg",{className:"".concat(l().basicInfoAdapterIcon),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M2 8.99374C2 5.68349 4.67654 3 8.00066 3H15.9993C19.3134 3 22 5.69478 22 8.99374V21H8.00066C4.68659 21 2 18.3052 2 15.0063V8.99374ZM20 19V8.99374C20 6.79539 18.2049 5 15.9993 5H8.00066C5.78458 5 4 6.78458 4 8.99374V15.0063C4 17.2046 5.79512 19 8.00066 19H20ZM14 11H16V13H14V11ZM8 11H10V13H8V11Z"})}),(0,s.jsx)("span",{className:"".concat(l().basicInfoAdapterLabel),children:t.adapterLabel})]}),(0,s.jsxs)("div",{className:"".concat(l().basicInfoPipelineContainer),children:[(0,s.jsx)("svg",{className:"".concat(l().basicInfoPipelineIcon),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M6 21.5C4.067 21.5 2.5 19.933 2.5 18C2.5 16.067 4.067 14.5 6 14.5C7.5852 14.5 8.92427 15.5539 9.35481 16.9992L15 16.9994V15L17 14.9994V9.24339L14.757 6.99938H9V9.00003H3V3.00003H9V4.99939H14.757L18 1.75739L22.2426 6.00003L19 9.24139V14.9994L21 15V21H15V18.9994L9.35499 19.0003C8.92464 20.4459 7.58543 21.5 6 21.5ZM6 16.5C5.17157 16.5 4.5 17.1716 4.5 18C4.5 18.8285 5.17157 19.5 6 19.5C6.82843 19.5 7.5 18.8285 7.5 18C7.5 17.1716 6.82843 16.5 6 16.5ZM19 17H17V19H19V17ZM18 4.58581L16.5858 6.00003L18 7.41424L19.4142 6.00003L18 4.58581ZM7 5.00003H5V7.00003H7V5.00003Z"})}),(0,s.jsx)("span",{className:"".concat(l().basicInfoPipelineLabel),children:t.usePipelineName})]})]}),(0,s.jsx)("div",{className:"".concat(l().botOperationContainer),children:(0,s.jsx)(h.d,{checked:t.enable,onCheckedChange:e=>{d.ok.updateBot(t.id,{name:t.name,description:t.description,adapter:t.adapter,adapter_config:t.adapterConfig,enable:e}).then(()=>{a(t.id,e)}).catch(e=>{console.error(e),u.oR.error(n("bots.setBotEnableError"))})},onClick:e=>{e.stopPropagation()}})})]})})}var x=a(6778),b=a(3355),g=a(4165),f=a(7160),j=a(285),C=a(3902);class v{constructor(e){this.id=e.id,this.name=e.name,this.default=e.default,this.label=e.label,this.required=e.required,this.type=e.type,this.description=e.description,this.options=e.options}}var _=a(5080),N=a(3549),L=a(221),w=a(2177),I=a(5594),V=a(5937),k=a(2523),y=a(9409);let B=e=>I.z.object({name:I.z.string().min(1,{message:e("bots.botNameRequired")}),description:I.z.string().min(1,{message:e("bots.botDescriptionRequired")}),adapter:I.z.string().min(1,{message:e("bots.adapterRequired")}),adapter_config:I.z.record(I.z.string(),I.z.any()),enable:I.z.boolean().optional(),use_pipeline_uuid:I.z.string().optional()});function S(e){var t;let{initBotId:a,onFormSubmit:i,onFormCancel:o,onBotDeleted:r,onNewBotCreated:c,hideButtons:l=!1}=e,{t:m}=(0,p.Bd)(),x=B(m),f=(0,w.mN)({resolver:(0,L.u)(x),defaultValues:{name:"",description:m("bots.defaultDescription"),adapter:"",adapter_config:{},enable:!0,use_pipeline_uuid:""}}),[I,S]=(0,n.useState)(!1),[H,P]=(0,n.useState)(new Map),[M,R]=(0,n.useState)(!1),[E,Z]=(0,n.useState)([]),[z,D]=(0,n.useState)({}),[A,F]=(0,n.useState)({}),[q,O]=(0,n.useState)([]),[T,$]=(0,n.useState)([]),[,U]=(0,n.useState)(!1);function J(){G().then(()=>{a?Y(a).then(e=>{f.setValue("name",e.name),f.setValue("description",e.description),f.setValue("adapter",e.adapter),f.setValue("adapter_config",e.adapter_config),f.setValue("enable",e.enable),f.setValue("use_pipeline_uuid",e.use_pipeline_uuid||""),console.log("form",f.getValues()),Q(e.adapter)}).catch(e=>{u.oR.error(m("bots.getBotConfigError")+e.message)}):f.reset()})}async function G(){let e=await d.ok.getPipelines();console.log("rawPipelineList",e),O(e.pipelines.map(e=>{var t;return{label:e.name,value:null!==(t=e.uuid)&&void 0!==t?t:""}}));let t=await d.ok.getAdapters();console.log("rawAdapterList",t),Z(t.adapters.map(e=>({label:(0,b.q)(e.label),value:e.name}))),D(t.adapters.reduce((e,t)=>(e[t.name]=d.ok.getAdapterIconURL(t.name),e),{})),F(t.adapters.reduce((e,t)=>(e[t.name]=(0,b.q)(t.description),e),{})),t.adapters.forEach(e=>{H.set(e.name,e.spec.config.map(e=>{var t,a;return new v({default:e.default,id:_.k.generate(),label:e.label,description:e.description,name:e.name,required:e.required,type:(a=t=e.type,Object.values(C.P).includes(a))?t:C.P.UNKNOWN})}))}),P(H)}async function Y(e){return new Promise((t,a)=>{d.ok.getBot(e).then(e=>{var a,s;let n=e.bot;t({adapter:n.adapter,description:n.description,name:n.name,adapter_config:n.adapter_config,enable:null===(a=n.enable)||void 0===a||a,use_pipeline_uuid:null!==(s=n.use_pipeline_uuid)&&void 0!==s?s:""})}).catch(e=>{a(e)})})}function Q(e){if(e){let t=H.get(e);t&&($(t),!a)&&f.setValue("adapter_config",t.reduce((e,t)=>(e[t.name]=t.default,e),{})),R(!0)}else R(!1)}function W(e){if(U(!0),console.log("set loading",!0),a){let e={uuid:a,name:f.getValues().name,description:f.getValues().description,adapter:f.getValues().adapter,adapter_config:f.getValues().adapter_config,enable:f.getValues().enable,use_pipeline_uuid:f.getValues().use_pipeline_uuid};d.ok.updateBot(a,e).then(e=>{console.log("update bot success",e),i(f.getValues()),u.oR.success(m("bots.saveSuccess"))}).catch(e=>{u.oR.error(m("bots.saveError")+e.message)}).finally(()=>{U(!1)})}else{console.log("submit create",f.getValues(),e);let t={name:f.getValues().name,description:f.getValues().description,adapter:f.getValues().adapter,adapter_config:f.getValues().adapter_config};d.ok.createBot(t).then(e=>{console.log("create bot success",e),u.oR.success(m("bots.createSuccess")),a=e.uuid,J(),c(e.uuid)}).catch(e=>{u.oR.error(m("bots.createError")+e.message)}).finally(()=>{U(!1),f.reset()})}}return(0,n.useEffect)(()=>{J()},[]),(0,s.jsxs)("div",{children:[(0,s.jsx)(g.lG,{open:I,onOpenChange:S,children:(0,s.jsxs)(g.Cf,{children:[(0,s.jsx)(g.c7,{children:(0,s.jsx)(g.L3,{children:m("common.confirmDelete")})}),(0,s.jsx)(g.rr,{children:m("bots.deleteConfirmation")}),(0,s.jsxs)(g.Es,{children:[(0,s.jsx)(j.$,{variant:"outline",onClick:()=>S(!1),children:"取消"}),(0,s.jsx)(j.$,{variant:"destructive",onClick:()=>{a&&d.ok.deleteBot(a).then(()=>{r(),u.oR.success(m("bots.deleteSuccess"))}).catch(e=>{u.oR.error(m("bots.deleteError")+e.message)}),S(!1)},children:m("common.confirmDelete")})]})]})}),(0,s.jsx)(V.lV,{...f,children:(0,s.jsxs)("form",{id:"bot-form",onSubmit:f.handleSubmit(W),className:"space-y-8",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[a&&(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)(V.zB,{control:f.control,name:"enable",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{className:"flex flex-col justify-start gap-[0.8rem] h-[3.8rem]",children:[(0,s.jsx)(V.lR,{children:m("common.enable")}),(0,s.jsx)(V.MJ,{children:(0,s.jsx)(h.d,{checked:t.value,onCheckedChange:t.onChange})})]})}}),(0,s.jsx)(V.zB,{control:f.control,name:"use_pipeline_uuid",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{className:"flex flex-col justify-start gap-[0.8rem] h-[3.8rem]",children:[(0,s.jsx)(V.lR,{children:m("bots.bindPipeline")}),(0,s.jsx)(V.MJ,{children:(0,s.jsxs)(y.l6,{onValueChange:t.onChange,...t,children:[(0,s.jsx)(y.bq,{children:(0,s.jsx)(y.yv,{placeholder:m("bots.selectPipeline")})}),(0,s.jsx)(y.gC,{className:"fixed z-[1000]",children:(0,s.jsx)(y.s3,{children:q.map(e=>(0,s.jsx)(y.eb,{value:e.value,children:e.label},e.value))})})]})})]})}})]}),(0,s.jsx)(V.zB,{control:f.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsxs)(V.lR,{children:[m("bots.botName"),(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(V.MJ,{children:(0,s.jsx)(k.p,{...t})}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:f.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsxs)(V.lR,{children:[m("bots.botDescription"),(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(V.MJ,{children:(0,s.jsx)(k.p,{...t})}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:f.control,name:"adapter",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsxs)(V.lR,{children:[m("bots.platformAdapter"),(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(V.MJ,{children:(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)(y.l6,{onValueChange:e=>{t.onChange(e),Q(e)},value:t.value,children:[(0,s.jsx)(y.bq,{className:"w-[180px]",children:(0,s.jsx)(y.yv,{placeholder:m("bots.selectAdapter")})}),(0,s.jsx)(y.gC,{className:"fixed z-[1000]",children:(0,s.jsx)(y.s3,{children:E.map(e=>(0,s.jsx)(y.eb,{value:e.value,children:e.label},e.value))})})]})})}),(0,s.jsx)(V.C5,{})]})}}),f.watch("adapter")&&(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[(0,s.jsx)("img",{src:z[f.watch("adapter")],alt:"adapter icon",className:"w-12 h-12"}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("div",{className:"font-medium",children:null===(t=E.find(e=>e.value===f.watch("adapter")))||void 0===t?void 0:t.label}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:A[f.watch("adapter")]})]})]}),M&&T.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"text-lg font-medium",children:m("bots.adapterConfig")}),(0,s.jsx)(N.A,{itemConfigList:T,initialValues:f.watch("adapter_config"),onSubmit:e=>{f.setValue("adapter_config",e)}})]})]}),!l&&(0,s.jsx)("div",{className:"sticky bottom-0 left-0 right-0 bg-background border-t p-4 mt-4",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[!a&&(0,s.jsx)(j.$,{type:"submit",onClick:f.handleSubmit(W),children:m("common.submit")}),a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.$,{type:"button",variant:"destructive",onClick:()=>S(!0),children:m("common.delete")}),(0,s.jsx)(j.$,{type:"button",onClick:f.handleSubmit(W),children:m("common.save")})]}),(0,s.jsx)(j.$,{type:"button",variant:"outline",onClick:()=>o(),children:m("common.cancel")})]})})]})})]})}class H{startListenServerPush(){let e=setInterval(()=>{this.getLogList(-1,50).then(e=>{this.callbacks.forEach(t=>t(this.parseResponse(e)))})},3e3);this.intervalIds.push(Number(e))}stopServerPush(){this.intervalIds.forEach(e=>clearInterval(e)),this.intervalIds=[]}subscribeLogPush(e){this.callbacks.includes(e)||this.callbacks.push(e)}dispose(){this.callbacks=[]}getLogList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return d.ok.getBotLogs(this.botId,{from_index:e,max_count:t})}async loadFirstPage(){return this.parseResponse(await this.getLogList(-1,10))}async loadMore(e,t){return this.parseResponse(await this.getLogList(e,t))}parseResponse(e){return e.logs}constructor(e){this.callbacks=[],this.intervalIds=[],this.botId=e}}var P=a(1947),M=a.n(P),R=a(9597);function E(e){let{botLog:t}=e,{t:a}=(0,p.Bd)(),n=d.ok.getBaseUrl();return(0,s.jsxs)("div",{className:"".concat(M().botLogCardContainer),children:[(0,s.jsxs)("div",{className:"".concat(M().cardTitleContainer),children:[(0,s.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,s.jsx)("div",{className:"".concat(M().tag),children:t.level}),t.message_session_id&&(0,s.jsxs)("div",{className:"".concat(M().tag," ").concat(M().chatTag),onClick:()=>{navigator.clipboard.writeText(t.message_session_id).then(()=>{u.oR.success(a("common.copySuccess"))})},children:[(0,s.jsxs)("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1664",width:"20",height:"20",fill:"currentColor",children:[(0,s.jsx)("path",{d:"M96.1 575.7a32.2 32.1 0 1 0 64.4 0 32.2 32.1 0 1 0-64.4 0Z","p-id":"1665",fill:"currentColor"}),(0,s.jsx)("path",{d:"M742.1 450.7l-269.5-2.1c-14.3-0.1-26 13.8-26 31s11.7 31.3 26 31.4l269.5 2.1c14.3 0.1 26-13.8 26-31s-11.7-31.3-26-31.4zM742.1 577.7l-269.5-2.1c-14.3-0.1-26 13.8-26 31s11.7 31.3 26 31.4l269.5 2.1c14.3 0.2 26-13.8 26-31s-11.7-31.3-26-31.4z","p-id":"1666",fill:"currentColor"}),(0,s.jsx)("path",{d:"M736.1 63.9H417c-70.4 0-128 57.6-128 128h-64.9c-70.4 0-128 57.6-128 128v128c-0.1 17.7 14.4 32 32.2 32 17.8 0 32.2-14.4 32.2-32.1V320c0-35.2 28.8-64 64-64H289v447.8c0 70.4 57.6 128 128 128h255.1c-0.1 35.2-28.8 63.8-64 63.8H224.5c-35.2 0-64-28.8-64-64V703.5c0-17.7-14.4-32.1-32.2-32.1-17.8 0-32.3 14.4-32.3 32.1v128.3c0 70.4 57.6 128 128 128h384.1c70.4 0 128-57.6 128-128h65c70.4 0 128-57.6 128-128V255.9l-193-192z m0.1 63.4l127.7 128.3H800c-35.2 0-64-28.8-64-64v-64.3h0.2z m64 641H416.1c-35.2 0-64-28.8-64-64v-513c0-35.2 28.8-64 64-64H671V191c0 70.4 57.6 128 128 128h65.2v385.3c0 35.2-28.8 64-64 64z","p-id":"1667",fill:"currentColor"})]}),(0,s.jsx)("span",{className:"".concat(M().chatId),children:t.message_session_id.split("")})]})]}),(0,s.jsx)("div",{children:function(e){let t=new Date,s=new Date(1e3*e),n=s.getFullYear(),i=s.getMonth()+1,o=s.getDate(),r=s.getHours().toString().padStart(2,"0"),c=s.getMinutes().toString().padStart(2,"0"),l=t.toDateString()===s.toDateString(),d=new Date(t.setDate(t.getDate()-1)).toDateString()===s.toDateString(),h=t.getFullYear()===n;return l?"".concat(r,":").concat(c):d?"".concat(a("bots.yesterday")," ").concat(r,":").concat(c):h?a("bots.dateFormat",{month:i,day:o}):a("bots.earlier")}(t.timestamp)})]}),(0,s.jsx)("div",{className:"".concat(M().cardTitleContainer," ").concat(M().cardText),children:t.text}),(0,s.jsx)(R.wy,{className:"",children:(0,s.jsx)("div",{className:"w-50 mt-2",children:t.images.map(e=>(0,s.jsx)("img",{src:"".concat(n,"/api/v1/files/image/").concat(e),alt:""},e))})})]})}var Z=a(5964),z=a.n(Z);function D(e){let{botId:t}=e,{t:a}=(0,p.Bd)(),i=(0,n.useRef)(new H(t)).current,[o,r]=(0,n.useState)([]),[c,l]=(0,n.useState)(!0),d=(0,n.useRef)(null),u=(0,n.useRef)(o);function m(e){r(e.reverse())}(0,n.useEffect)(()=>(i.subscribeLogPush(m),i.loadFirstPage().then(e=>{r(e.reverse())}),d.current&&d.current.addEventListener("scroll",x),()=>{i.dispose(),d.current&&d.current.removeEventListener("scroll",x)}),[]),(0,n.useEffect)(()=>{u.current=o},[o]),(0,n.useEffect)(()=>(c?i.startListenServerPush():i.stopServerPush(),()=>{i.stopServerPush()}),[c]);let x=(0,n.useCallback)(z()(()=>{if(!d.current)return;let{scrollTop:e,scrollHeight:t,clientHeight:a}=d.current,s=e+a>=t-5,n=0===e;s&&(l(!1),function(){let e=u.current,t=e[e.length-1].seq_id;0!==t&&i.loadMore(t-1,10).then(t=>{r([...e,...t.reverse()])})}()),n&&l(!0),n||s||l(!1)},300),[o]);return(0,s.jsxs)("div",{className:"".concat(M().botLogListContainer),ref:d,children:[(0,s.jsxs)("div",{className:"".concat(M().listHeader),children:[(0,s.jsx)("div",{className:"mr-2",children:a("bots.enableAutoRefresh")}),(0,s.jsx)(h.d,{checked:c,onCheckedChange:e=>l(e)})]}),o.map(e=>(0,s.jsx)(E,{botLog:e},e.seq_id))]})}function A(e){let{open:t,onOpenChange:a,botId:i,onFormSubmit:o,onFormCancel:r,onBotDeleted:c,onNewBotCreated:l}=e,{t:h}=(0,p.Bd)(),[u,m]=(0,n.useState)(i),[x,b]=(0,n.useState)("config"),[C,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{m(i),b("config")},[i,t]);let _=[{key:"config",label:h("bots.configuration"),icon:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M5 7C5 6.17157 5.67157 5.5 6.5 5.5C7.32843 5.5 8 6.17157 8 7C8 7.82843 7.32843 8.5 6.5 8.5C5.67157 8.5 5 7.82843 5 7ZM6.5 3.5C4.567 3.5 3 5.067 3 7C3 8.933 4.567 10.5 6.5 10.5C8.433 10.5 10 8.933 10 7C10 5.067 8.433 3.5 6.5 3.5ZM12 8H20V6H12V8ZM16 17C16 16.1716 16.6716 15.5 17.5 15.5C18.3284 15.5 19 16.1716 19 17C19 17.8284 18.3284 18.5 17.5 18.5C16.6716 18.5 16 17.8284 16 17ZM17.5 13.5C15.567 13.5 14 15.067 14 17C14 18.933 15.567 20.5 17.5 20.5C19.433 20.5 21 18.933 21 17C21 15.067 19.433 13.5 17.5 13.5ZM4 16V18H12V16H4Z"})})},{key:"logs",label:h("bots.logs"),icon:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M21 8V20.9932C21 21.5501 20.5552 22 20.0066 22H3.9934C3.44495 22 3 21.556 3 21.0082V2.9918C3 2.45531 3.4487 2 4.00221 2H14.9968L21 8ZM19 9H14V4H5V20H19V9ZM8 7H11V9H8V7ZM8 11H16V13H8V11ZM8 15H16V17H8V15Z"})})}],N=e=>{o(e)},L=()=>{r()},w=()=>{d.ok.deleteBot(null!=u?u:"").then(()=>{c()})},I=e=>{m(e),b("config"),l(e)};return u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.lG,{open:t,onOpenChange:a,children:(0,s.jsx)(g.Cf,{className:"overflow-hidden p-0 !max-w-[50rem] max-h-[75vh] flex",children:(0,s.jsxs)(f.GB,{className:"items-start w-full flex",children:[(0,s.jsx)(f.Bx,{collapsible:"none",className:"hidden md:flex h-[80vh] w-40 min-w-[120px] border-r bg-white",children:(0,s.jsx)(f.Yv,{children:(0,s.jsx)(f.Cn,{children:(0,s.jsx)(f.rQ,{children:(0,s.jsx)(f.wZ,{children:_.map(e=>(0,s.jsx)(f.FX,{children:(0,s.jsx)(f.Uj,{asChild:!0,isActive:x===e.key,onClick:()=>b(e.key),children:(0,s.jsxs)("a",{href:"#",children:[e.icon,(0,s.jsx)("span",{children:e.label})]})})},e.key))})})})})}),(0,s.jsxs)("main",{className:"flex flex-1 flex-col h-[75vh]",children:[(0,s.jsx)(g.c7,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,s.jsx)(g.L3,{children:h("config"===x?"bots.editBot":"bots.botLogTitle")})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:["config"===x&&(0,s.jsx)(S,{initBotId:u,onFormSubmit:N,onFormCancel:L,onBotDeleted:w,onNewBotCreated:I,hideButtons:!0}),"logs"===x&&u&&(0,s.jsx)(D,{botId:u})]}),"config"===x&&(0,s.jsx)(g.Es,{className:"px-6 py-4 border-t shrink-0",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(j.$,{type:"button",variant:"destructive",onClick:()=>{v(!0)},children:h("common.delete")}),(0,s.jsx)(j.$,{type:"submit",form:"bot-form",children:h("common.save")}),(0,s.jsx)(j.$,{type:"button",variant:"outline",onClick:L,children:h("common.cancel")})]})})]})]})})}),(0,s.jsx)(g.lG,{open:C,onOpenChange:v,children:(0,s.jsxs)(g.Cf,{children:[(0,s.jsx)(g.c7,{children:(0,s.jsx)(g.L3,{children:h("common.confirmDelete")})}),(0,s.jsx)("div",{className:"py-4",children:h("bots.deleteConfirmation")}),(0,s.jsxs)(g.Es,{children:[(0,s.jsx)(j.$,{variant:"outline",onClick:()=>v(!1),children:h("common.cancel")}),(0,s.jsx)(j.$,{variant:"destructive",onClick:()=>{w(),v(!1)},children:h("common.confirmDelete")})]})]})})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(g.lG,{open:t,onOpenChange:a,children:(0,s.jsx)(g.Cf,{className:"overflow-hidden p-0 !max-w-[40vw] max-h-[70vh] flex",children:(0,s.jsxs)("main",{className:"flex flex-1 flex-col h-[70vh]",children:[(0,s.jsx)(g.c7,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,s.jsx)(g.L3,{children:h("bots.createBot")})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:(0,s.jsx)(S,{initBotId:void 0,onFormSubmit:N,onFormCancel:L,onBotDeleted:w,onNewBotCreated:I,hideButtons:!0})}),(0,s.jsx)(g.Es,{className:"px-6 py-4 border-t shrink-0",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(j.$,{type:"submit",form:"bot-form",children:h("common.submit")}),(0,s.jsx)(j.$,{type:"button",variant:"outline",onClick:L,children:h("common.cancel")})]})})]})})})})}function F(){let{t:e}=(0,p.Bd)(),[t,a]=(0,n.useState)(!1),[i,c]=(0,n.useState)([]),[l,h]=(0,n.useState)("");async function g(){let t=(await d.ok.getAdapters()).adapters.map(e=>({label:(0,b.q)(e.label),value:e.name}));d.ok.getBots().then(e=>{c(e.bots.map(e=>{var a;return new r({id:e.uuid||"",iconURL:d.ok.getAdapterIconURL(e.adapter),name:e.name,description:e.description,adapter:e.adapter,adapterConfig:e.adapter_config,adapterLabel:(null===(a=t.find(t=>t.value===e.adapter))||void 0===a?void 0:a.label)||e.adapter.substring(0,10),usePipelineName:e.use_pipeline_name||"",enable:e.enable||!1})}))}).catch(t=>{console.error("get bot list error",t),u.oR.error(e("bots.getBotListError")+t.message)}).finally(()=>{})}return(0,n.useEffect)(()=>{g()},[]),(0,s.jsxs)("div",{className:o().configPageContainer,children:[(0,s.jsx)(A,{open:t,onOpenChange:a,botId:l||void 0,onFormSubmit:function(){g()},onFormCancel:function(){a(!1)},onBotDeleted:function(){g(),a(!1)},onNewBotCreated:function(e){console.log("new bot created",e),g(),h(e)}}),(0,s.jsxs)("div",{className:"".concat(o().botListContainer),children:[(0,s.jsx)(x.A,{width:"100%",height:"10rem",plusSize:"90px",onClick:function(){h(""),a(!0)}}),i.map(e=>(0,s.jsx)("div",{onClick:()=>{h(e.id),a(!0)},children:(0,s.jsx)(m,{botCardVO:e,setBotEnableCallback:(e,t)=>{c(i.map(a=>a.id===e?{...a,enable:t}:a))}})},e.id))]})]})}},3393:e=>{e.exports={botListContainer:"botConfig_botListContainer__9q0La"}},3822:(e,t,a)=>{Promise.resolve().then(a.bind(a,2552))},5045:e=>{e.exports={cardContainer:"botCard_cardContainer__4SfCX",iconBasicInfoContainer:"botCard_iconBasicInfoContainer__Q0J6Z",iconImage:"botCard_iconImage__gNQ8J",basicInfoContainer:"botCard_basicInfoContainer__aCgVJ",basicInfoNameContainer:"botCard_basicInfoNameContainer__yOqEd",basicInfoName:"botCard_basicInfoName__OghZA",basicInfoDescription:"botCard_basicInfoDescription__44Rw5",basicInfoAdapterContainer:"botCard_basicInfoAdapterContainer__7T2go",basicInfoAdapterIcon:"botCard_basicInfoAdapterIcon__27SBz",basicInfoAdapterLabel:"botCard_basicInfoAdapterLabel__UgoPr",basicInfoPipelineContainer:"botCard_basicInfoPipelineContainer__GSo5Y",basicInfoPipelineIcon:"botCard_basicInfoPipelineIcon__7GePd",basicInfoPipelineLabel:"botCard_basicInfoPipelineLabel__twgII",bigText:"botCard_bigText__b2p_W",botOperationContainer:"botCard_botOperationContainer__Erox_"}}},e=>{var t=t=>e(e.s=t);e.O(0,[939,394,218,464,352,211,671,994,726,982,914,869,334,554,977,595,441,684,358],()=>t(3822)),_N_E=e.O()}]);