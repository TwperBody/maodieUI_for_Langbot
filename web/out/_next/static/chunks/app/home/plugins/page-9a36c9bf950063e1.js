(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[431],{4650:e=>{e.exports={pageContainer:"plugins_pageContainer__ILtMn",marketComponentBody:"plugins_marketComponentBody__rC1uz",pluginListContainer:"plugins_pluginListContainer__H1dsl"}},5296:(e,s,t)=>{Promise.resolve().then(t.bind(t,6394))},6126:(e,s,t)=>{"use strict";t.d(s,{E:()=>c});var n=t(5155);t(2115);var i=t(9708),l=t(2085),a=t(9434);let r=(0,l.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:s,variant:t,asChild:l=!1,...c}=e,o=l?i.DX:"span";return(0,n.jsx)(o,{"data-slot":"badge",className:(0,a.cn)(r({variant:t}),s),...c})}},6394:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>D});var n=t(5155),i=t(2115);class l{constructor(e){this.author=e.author,this.description=e.description,this.enabled=e.enabled,this.event_handlers=e.event_handlers,this.name=e.name,this.priority=e.priority,this.repository=e.repository,this.status=e.status,this.tools=e.tools,this.version=e.version}}var a=t(9120),r=t(6126),c=t(333),o=t(6671),d=t(1218);function u(e){let{cardVO:s,onCardClick:t}=e,{t:l}=(0,d.Bd)(),[u,x]=(0,i.useState)(s.enabled),[m,h]=(0,i.useState)(!0);return(0,n.jsx)("div",{className:"w-[100%] h-[10rem] bg-white rounded-[10px] shadow-[0px_2px_2px_0_rgba(0,0,0,0.2)] p-[1.2rem] cursor-pointer",onClick:t,children:(0,n.jsxs)("div",{className:"w-full h-full flex flex-row items-start justify-start gap-[1.2rem]",children:[(0,n.jsx)("svg",{className:"w-16 h-16 text-[#2288ee]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M8 4C8 2.34315 9.34315 1 11 1C12.6569 1 14 2.34315 14 4C14 4.35064 13.9398 4.68722 13.8293 5H18C18.5523 5 19 5.44772 19 6V10.1707C19.3128 10.0602 19.6494 10 20 10C21.6569 10 23 11.3431 23 13C23 14.6569 21.6569 16 20 16C19.6494 16 19.3128 15.9398 19 15.8293V20C19 20.5523 18.5523 21 18 21H4C3.44772 21 3 20.5523 3 20V6C3 5.44772 3.44772 5 4 5H8.17071C8.06015 4.68722 8 4.35064 8 4Z"})}),(0,n.jsxs)("div",{className:"w-full h-full flex flex-col items-start justify-between gap-[0.6rem]",children:[(0,n.jsxs)("div",{className:"flex flex-col items-start justify-start",children:[(0,n.jsxs)("div",{className:"flex flex-col items-start justify-start",children:[(0,n.jsxs)("div",{className:"text-[0.7rem] text-[#666]",children:[s.author," /"," "]}),(0,n.jsxs)("div",{className:"flex flex-row items-center justify-start gap-[0.4rem]",children:[(0,n.jsx)("div",{className:"text-[1.2rem] text-black",children:s.name}),(0,n.jsxs)(r.E,{variant:"outline",className:"text-[0.7rem]",children:["v",s.version]})]})]}),(0,n.jsx)("div",{className:"text-[0.8rem] text-[#666] line-clamp-2",children:s.description})]}),(0,n.jsxs)("div",{className:"w-full flex flex-row items-start justify-start gap-[0.6rem]",children:[(0,n.jsxs)("div",{className:"flex h-full flex-row items-center justify-center gap-[0.4rem]",children:[(0,n.jsx)("svg",{className:"w-[1.2rem] h-[1.2rem] text-black",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M24 12L18.3431 17.6569L16.9289 16.2426L21.1716 12L16.9289 7.75736L18.3431 6.34315L24 12ZM2.82843 12L7.07107 16.2426L5.65685 17.6569L0 12L5.65685 6.34315L7.07107 7.75736L2.82843 12ZM9.78845 21H7.66009L14.2116 3H16.3399L9.78845 21Z"})}),(0,n.jsx)("div",{className:"text-base text-black font-medium",children:l("plugins.eventCount",{count:Object.keys(s.event_handlers).length})})]}),(0,n.jsxs)("div",{className:"flex h-full flex-row items-center justify-center gap-[0.4rem]",children:[(0,n.jsx)("svg",{className:"w-[1.2rem] h-[1.2rem] text-black",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M5.32943 3.27158C6.56252 2.8332 7.9923 3.10749 8.97927 4.09446C10.1002 5.21537 10.3019 6.90741 9.5843 8.23385L20.293 18.9437L18.8788 20.3579L8.16982 9.64875C6.84325 10.3669 5.15069 10.1654 4.02952 9.04421C3.04227 8.05696 2.7681 6.62665 3.20701 5.39332L5.44373 7.63C6.02952 8.21578 6.97927 8.21578 7.56505 7.63C8.15084 7.04421 8.15084 6.09446 7.56505 5.50868L5.32943 3.27158ZM15.6968 5.15512L18.8788 3.38736L20.293 4.80157L18.5252 7.98355L16.7574 8.3371L14.6361 10.4584L13.2219 9.04421L15.3432 6.92289L15.6968 5.15512ZM8.97927 13.2868L10.3935 14.7011L5.09018 20.0044C4.69966 20.3949 4.06649 20.3949 3.67597 20.0044C3.31334 19.6417 3.28744 19.0699 3.59826 18.6774L3.67597 18.5902L8.97927 13.2868Z"})}),(0,n.jsx)("div",{className:"text-base text-black font-medium",children:l("plugins.toolCount",{count:s.tools.length})})]})]})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center justify-between h-full",children:[(0,n.jsx)("div",{className:"flex items-center justify-center",children:(0,n.jsx)(c.d,{className:"cursor-pointer",checked:u,onClick:e=>{e.stopPropagation(),h(!1),a.ok.togglePlugin(s.author,s.name,!u).then(()=>{x(!u)}).catch(e=>{o.oR.error(l("plugins.modifyFailed")+e.message)}).finally(()=>{h(!0)})},disabled:!m})}),(0,n.jsx)("div",{className:"flex items-center justify-center"})]})]})})}var x=t(3549),m=t(285),h=t(4165),p=t(3355),g=function(e){return e.WAIT_INPUT="WAIT_INPUT",e.REMOVING="REMOVING",e.ERROR="ERROR",e}(g||{});function f(e){let{pluginAuthor:s,pluginName:t,onFormSubmit:l,onFormCancel:r}=e,{t:c}=(0,d.Bd)(),[u,g]=(0,i.useState)(),[f,v]=(0,i.useState)(),[j,C]=(0,i.useState)(!1),[N,b]=(0,i.useState)(!1),[w,y]=(0,i.useState)("WAIT_INPUT"),[k,L]=(0,i.useState)(null);(0,i.useEffect)(()=>{a.ok.getPlugin(s,t).then(e=>{g(e.plugin)}),a.ok.getPluginConfig(s,t).then(e=>{v(e)})},[s,t]);let _=async e=>{C(!0),a.ok.updatePluginConfig(s,t,e).then(()=>{l(),o.oR.success("保存成功")}).catch(e=>{o.oR.error("保存失败："+e.message)}).finally(()=>{C(!1)})};return u&&f?(0,n.jsxs)("div",{children:[(0,n.jsx)(h.lG,{open:N,onOpenChange:b,children:(0,n.jsxs)(h.Cf,{children:[(0,n.jsx)(h.c7,{children:(0,n.jsx)(h.L3,{children:c("plugins.deleteConfirm")})}),(0,n.jsxs)(h.rr,{children:["WAIT_INPUT"===w&&(0,n.jsx)("div",{children:c("plugins.confirmDeletePlugin",{author:s,name:t})}),"REMOVING"===w&&(0,n.jsx)("div",{children:c("plugins.deleting")}),"ERROR"===w&&(0,n.jsxs)("div",{children:[c("plugins.deleteError"),(0,n.jsx)("div",{className:"text-red-500",children:k})]})]}),(0,n.jsxs)(h.Es,{children:["WAIT_INPUT"===w&&(0,n.jsx)(m.$,{variant:"outline",onClick:()=>{b(!1),y("WAIT_INPUT")},children:c("plugins.cancel")}),"WAIT_INPUT"===w&&(0,n.jsx)(m.$,{variant:"destructive",onClick:()=>{y("REMOVING"),a.ok.removePlugin(s,t).then(e=>{let s=e.task_id,t=!1,n=setInterval(()=>{a.ok.getAsyncTask(s).then(e=>{e.runtime.done&&(clearInterval(n),e.runtime.exception?(L(e.runtime.exception),y("ERROR")):(t||(o.oR.success("插件删除成功"),t=!0),y("WAIT_INPUT"),b(!1),l()))})},1e3)}).catch(e=>{L(e.message),y("ERROR")})},children:c("plugins.confirmDelete")}),"REMOVING"===w&&(0,n.jsx)(m.$,{variant:"destructive",disabled:!0,children:c("plugins.deleting")}),"ERROR"===w&&(0,n.jsx)(m.$,{variant:"default",onClick:()=>{b(!1)},children:c("plugins.close")})]})]})}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-lg font-medium",children:u.name}),(0,n.jsx)("div",{className:"text-sm text-gray-500 pb-2",children:(0,p.q)(u.description)}),u.config_schema.length>0&&(0,n.jsx)(x.A,{itemConfigList:u.config_schema,initialValues:f.config,onSubmit:e=>{let s=f.config;v({config:s={...s,...e}})}}),0===u.config_schema.length&&(0,n.jsx)("div",{className:"text-sm text-gray-500",children:c("plugins.pluginNoConfig")})]}),(0,n.jsx)("div",{className:"sticky bottom-0 left-0 right-0 bg-background border-t p-4 mt-4",children:(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(m.$,{variant:"destructive",onClick:()=>{b(!0),y("WAIT_INPUT")},disabled:"REMOVING"===w,children:c("REMOVING"===w?"plugins.deleting":"plugins.deletePlugin")}),(0,n.jsx)(m.$,{type:"submit",onClick:()=>_(f.config),disabled:j,children:c(j?"plugins.saving":"plugins.saveConfig")}),(0,n.jsx)(m.$,{type:"button",variant:"outline",onClick:r,children:c("plugins.cancel")})]})})]}):(0,n.jsx)("div",{children:c("plugins.loading")})}var v=t(4650),j=t.n(v);let C=(0,i.forwardRef)((e,s)=>{let{t}=(0,d.Bd)(),[r,c]=(0,i.useState)([]),[o,x]=(0,i.useState)(!1),[m,g]=(0,i.useState)(null);function v(){a.ok.getPlugins().then(e=>{c(e.plugins.map(e=>new l({author:e.author,description:(0,p.q)(e.description),enabled:e.enabled,name:e.name,version:e.version,status:e.status,tools:e.tools,event_handlers:e.event_handlers,repository:e.repository,priority:e.priority})))})}return(0,i.useEffect)(()=>{v()},[]),(0,i.useImperativeHandle)(s,()=>({refreshPluginList:v})),(0,n.jsx)(n.Fragment,{children:0===r.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 h-[calc(100vh-16rem)] w-full gap-2",children:[(0,n.jsx)("svg",{className:"h-[3rem] w-[3rem]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M7 5C7 2.79086 8.79086 1 11 1C13.2091 1 15 2.79086 15 5H20C20.5523 5 21 5.44772 21 6V10.1707C21 10.4953 20.8424 10.7997 20.5774 10.9872C20.3123 11.1746 19.9728 11.2217 19.6668 11.1135C19.4595 11.0403 19.2355 11 19 11C17.8954 11 17 11.8954 17 13C17 14.1046 17.8954 15 19 15C19.2355 15 19.4595 14.9597 19.6668 14.8865C19.9728 14.7783 20.3123 14.8254 20.5774 15.0128C20.8424 15.2003 21 15.5047 21 15.8293V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V6C3 5.44772 3.44772 5 4 5H7ZM11 3C9.89543 3 9 3.89543 9 5C9 5.23554 9.0403 5.45952 9.11355 5.66675C9.22172 5.97282 9.17461 6.31235 8.98718 6.57739C8.79974 6.84243 8.49532 7 8.17071 7H5V19H19V17C16.7909 17 15 15.2091 15 13C15 10.7909 16.7909 9 19 9V7H13.8293C13.5047 7 13.2003 6.84243 13.0128 6.57739C12.8254 6.31235 12.7783 5.97282 12.8865 5.66675C12.9597 5.45952 13 5.23555 13 5C13 3.89543 12.1046 3 11 3Z"})}),(0,n.jsx)("div",{className:"text-lg mb-2",children:t("plugins.noPluginInstalled")})]}):(0,n.jsxs)("div",{className:"".concat(j().pluginListContainer),children:[(0,n.jsx)(h.lG,{open:o,onOpenChange:x,children:(0,n.jsxs)(h.Cf,{className:"w-[700px] max-h-[80vh] p-0 flex flex-col",children:[(0,n.jsx)(h.c7,{className:"px-6 pt-6 pb-2",children:(0,n.jsx)(h.L3,{children:t("plugins.pluginConfig")})}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto px-6",children:m&&(0,n.jsx)(f,{pluginAuthor:m.author,pluginName:m.name,onFormSubmit:()=>{x(!1),v()},onFormCancel:()=>{x(!1)}})})]})}),r.map((e,s)=>(0,n.jsx)("div",{children:(0,n.jsx)(u,{cardVO:e,onCardClick:()=>{g(e),x(!0)}})},s))]})})});class N{constructor(e){this.description=e.description,this.name=e.name,this.author=e.author,this.githubURL=e.githubURL,this.starCount=e.starCount,this.pluginId=e.pluginId,this.version=e.version}}function b(e){let{cardVO:s,installPlugin:t}=e,{t:i}=(0,d.Bd)();return(0,n.jsx)("div",{className:"w-[100%] h-[10rem] bg-white rounded-[10px] shadow-[0px_2px_2px_0_rgba(0,0,0,0.2)] p-[1.2rem]",children:(0,n.jsxs)("div",{className:"w-full h-full flex flex-row items-start justify-start gap-[1.2rem]",children:[(0,n.jsx)("svg",{className:"w-16 h-16 text-[#2288ee]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M8 4C8 2.34315 9.34315 1 11 1C12.6569 1 14 2.34315 14 4C14 4.35064 13.9398 4.68722 13.8293 5H18C18.5523 5 19 5.44772 19 6V10.1707C19.3128 10.0602 19.6494 10 20 10C21.6569 10 23 11.3431 23 13C23 14.6569 21.6569 16 20 16C19.6494 16 19.3128 15.9398 19 15.8293V20C19 20.5523 18.5523 21 18 21H4C3.44772 21 3 20.5523 3 20V6C3 5.44772 3.44772 5 4 5H8.17071C8.06015 4.68722 8 4.35064 8 4Z"})}),(0,n.jsxs)("div",{className:"w-full h-full flex flex-col items-start justify-between gap-[0.6rem]",children:[(0,n.jsxs)("div",{className:"flex flex-col items-start justify-start",children:[(0,n.jsxs)("div",{className:"flex flex-col items-start justify-start",children:[(0,n.jsxs)("div",{className:"text-[0.7rem] text-[#666]",children:[s.author," /"," "]}),(0,n.jsx)("div",{className:"flex flex-row items-center justify-start gap-[0.4rem]",children:(0,n.jsx)("div",{className:"text-[1.2rem] text-black",children:s.name})})]}),(0,n.jsx)("div",{className:"text-[0.8rem] text-[#666] line-clamp-2",children:s.description})]}),(0,n.jsxs)("div",{className:"w-full flex flex-row items-start justify-between gap-[0.6rem]",children:[(0,n.jsxs)("div",{className:"flex h-full flex-row items-center justify-center gap-[0.4rem]",children:[(0,n.jsx)("svg",{className:"w-[1.2rem] h-[1.2rem] text-[#ffcd27]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M12.0006 18.26L4.94715 22.2082L6.52248 14.2799L0.587891 8.7918L8.61493 7.84006L12.0006 0.5L15.3862 7.84006L23.4132 8.7918L17.4787 14.2799L19.054 22.2082L12.0006 18.26Z"})}),(0,n.jsx)("div",{className:"text-base text-[#ffcd27] font-medium",children:i("plugins.starCount",{count:s.starCount})})]}),(0,n.jsxs)("div",{className:"flex h-full flex-row items-center justify-center gap-[0.4rem]",children:[(0,n.jsx)("svg",{className:"w-[1.4rem] h-[1.4rem] text-black cursor-pointer",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",onClick:()=>window.open(s.githubURL,"_blank"),children:(0,n.jsx)("path",{d:"M12.001 2C6.47598 2 2.00098 6.475 2.00098 12C2.00098 16.425 4.86348 20.1625 8.83848 21.4875C9.33848 21.575 9.52598 21.275 9.52598 21.0125C9.52598 20.775 9.51348 19.9875 9.51348 19.15C7.00098 19.6125 6.35098 18.5375 6.15098 17.975C6.03848 17.6875 5.55098 16.8 5.12598 16.5625C4.77598 16.375 4.27598 15.9125 5.11348 15.9C5.90098 15.8875 6.46348 16.625 6.65098 16.925C7.55098 18.4375 8.98848 18.0125 9.56348 17.75C9.65098 17.1 9.91348 16.6625 10.201 16.4125C7.97598 16.1625 5.65098 15.3 5.65098 11.475C5.65098 10.3875 6.03848 9.4875 6.67598 8.7875C6.57598 8.5375 6.22598 7.5125 6.77598 6.1375C6.77598 6.1375 7.61348 5.875 9.52598 7.1625C10.326 6.9375 11.176 6.825 12.026 6.825C12.876 6.825 13.726 6.9375 14.526 7.1625C16.4385 5.8625 17.276 6.1375 17.276 6.1375C17.826 7.5125 17.476 8.5375 17.376 8.7875C18.0135 9.4875 18.401 10.375 18.401 11.475C18.401 15.3125 16.0635 16.1625 13.8385 16.4125C14.201 16.725 14.5135 17.325 14.5135 18.2625C14.5135 19.6 14.501 20.675 14.501 21.0125C14.501 21.275 14.6885 21.5875 15.1885 21.4875C19.259 20.1133 21.9999 16.2963 22.001 12C22.001 6.475 17.526 2 12.001 2Z"})}),(0,n.jsx)(m.$,{variant:"default",size:"sm",onClick:()=>{t(s.githubURL)},className:"cursor-pointer",children:i("plugins.install")})]})]})]})]})})}var w=t(2523),y=t(2355),k=t(3052),L=t(9434);function _(e){let{className:s,...t}=e;return(0,n.jsx)("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:(0,L.cn)("mx-auto flex w-full justify-center",s),...t})}function S(e){let{className:s,...t}=e;return(0,n.jsx)("ul",{"data-slot":"pagination-content",className:(0,L.cn)("flex flex-row items-center gap-1",s),...t})}function I(e){let{...s}=e;return(0,n.jsx)("li",{"data-slot":"pagination-item",...s})}function R(e){let{className:s,isActive:t,size:i="icon",...l}=e;return(0,n.jsx)("a",{"aria-current":t?"page":void 0,"data-slot":"pagination-link","data-active":t,className:(0,L.cn)((0,m.r)({variant:t?"outline":"ghost",size:i}),s),...l})}function E(e){let{className:s,...t}=e;return(0,n.jsxs)(R,{"aria-label":"Go to previous page",size:"default",className:(0,L.cn)("gap-1 px-2.5 sm:pl-2.5",s),...t,children:[(0,n.jsx)(y.A,{className:"text-black"}),(0,n.jsx)("span",{className:"hidden sm:block"})]})}function P(e){let{className:s,...t}=e;return(0,n.jsxs)(R,{"aria-label":"Go to next page",size:"default",className:(0,L.cn)("gap-1 px-2.5 sm:pr-2.5",s),...t,children:[(0,n.jsx)("span",{className:"hidden sm:block"}),(0,n.jsx)(k.A,{className:"text-black"})]})}var M=t(9409);function T(e){let{askInstallPlugin:s}=e,{t}=(0,d.Bd)(),[l,r]=(0,i.useState)([]),[c,o]=(0,i.useState)(0),[u,x]=(0,i.useState)(1),[m,h]=(0,i.useState)(""),[p,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)("pushed_at"),[C,y]=(0,i.useState)("DESC"),k=(0,i.useRef)(null);function L(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C;g(!0),a.W3.getMarketPlugins(e,12,s,n,i).then(e=>{r(e.plugins.map(e=>{let s=e.repository;s.startsWith("https://github.com/")&&(s=s.replace("https://github.com/","")),s.startsWith("github.com/")&&(s=s.replace("github.com/",""));let t=s.split("/")[0],n=s.split("/")[1];return new N({author:t,description:e.description,githubURL:"https://github.com/".concat(s),name:n,pluginId:String(e.ID),starCount:e.stars,version:"version"in e?String(e.version):"1.0.0"})})),o(e.total),g(!1),console.log("market plugins:",e)}).catch(e=>{console.error(t("plugins.getPluginListError"),e),g(!1)})}function T(e){x(e),L(e)}return(0,i.useEffect)(()=>{L()},[]),(0,n.jsxs)("div",{className:"".concat(j().marketComponentBody),children:[(0,n.jsxs)("div",{className:"flex items-center justify-start mb-2 mt-2 pl-[0.8rem] pr-[0.8rem]",children:[(0,n.jsx)(w.p,{style:{width:"300px"},value:m,placeholder:t("plugins.searchPlugin"),onChange:e=>{var s;h(s=e.target.value),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{x(1),L(1,s)},500)}}),(0,n.jsxs)(M.l6,{value:"".concat(f,",").concat(C),onValueChange:function(e){let[s,t]=e.split(",").map(e=>e.trim());v(s),y(t),x(1),L(1,m,s,t)},children:[(0,n.jsx)(M.bq,{className:"w-[180px] ml-2 cursor-pointer",children:(0,n.jsx)(M.yv,{placeholder:t("plugins.sortBy")})}),(0,n.jsxs)(M.gC,{children:[(0,n.jsx)(M.eb,{value:"stars,DESC",children:t("plugins.mostStars")}),(0,n.jsx)(M.eb,{value:"created_at,DESC",children:t("plugins.recentlyAdded")}),(0,n.jsx)(M.eb,{value:"pushed_at,DESC",children:t("plugins.recentlyUpdated")})]})]}),(0,n.jsx)("div",{className:"flex items-center justify-end ml-2",children:c>0&&(0,n.jsx)(_,{children:(0,n.jsxs)(S,{children:[(0,n.jsx)(I,{className:"cursor-pointer",children:(0,n.jsx)(E,{onClick:()=>T(u-1),className:u<=1?"pointer-events-none opacity-50":""})}),(()=>{let e=Math.max(1,u-Math.floor(2.5)),s=Math.min(Math.ceil(c/12),e+5-1);return s-e+1<5&&(e=Math.max(1,s-5+1)),Array.from({length:s-e+1},(s,t)=>{let i=e+t;return(0,n.jsx)(I,{className:"cursor-pointer",children:(0,n.jsx)(R,{isActive:i===u,onClick:()=>T(i),children:(0,n.jsx)("span",{className:"text-black select-none",children:i})})},i)})})(),(0,n.jsx)(I,{className:"cursor-pointer",children:(0,n.jsx)(P,{onClick:()=>T(u+1),className:u>=Math.ceil(c/12)?"pointer-events-none opacity-50":""})})]})})})]}),(0,n.jsx)("div",{className:"".concat(j().pluginListContainer),children:p?(0,n.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:t("plugins.loading")}):0===l.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:t("plugins.noMatchingPlugins")}):l.map((e,t)=>(0,n.jsx)("div",{children:(0,n.jsx)(b,{cardVO:e,installPlugin:e=>{s(e)}})},"".concat(e.pluginId,"-").concat(t)))})]})}var A=t(5143),V=t(402),O=t(8266);function B(e){let{plugin:s}=e,{attributes:t,listeners:i,setNodeRef:l,transform:a,transition:r}=(0,V.gl)({id:"".concat(s.author,"-").concat(s.name)}),c={transform:O.Ks.Transform.toString(a),transition:r};return(0,n.jsx)("div",{ref:l,style:c,...t,...i,className:"bg-white dark:bg-gray-800 p-4 rounded-md shadow-sm border mb-2 cursor-move",children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.author}),(0,n.jsx)("div",{className:"text-lg font-medium",children:s.name}),(0,n.jsx)("div",{className:"text-sm line-clamp-2 text-gray-500 dark:text-gray-400 mt-1",children:s.description})]})})}function G(e){let{open:s,onOpenChange:t,onSortComplete:r}=e,{t:c}=(0,d.Bd)(),[u,x]=(0,i.useState)([]),[g,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{s&&a.ok.getPlugins().then(e=>{x(e.plugins.map(e=>new l({author:e.author,description:(0,p.q)(e.description),enabled:e.enabled,name:e.name,version:e.version,status:e.status,tools:e.tools,event_handlers:e.event_handlers,repository:e.repository,priority:e.priority})))})},[s]);let v=(0,A.FR)((0,A.MS)(A.AN),(0,A.MS)(A.uN,{coordinateGetter:V.JR}));return(0,n.jsx)(h.lG,{open:s,onOpenChange:t,children:(0,n.jsxs)(h.Cf,{className:"w-[700px] max-h-[80vh] p-0 flex flex-col",children:[(0,n.jsx)(h.c7,{className:"px-6 pt-6 pb-0",children:(0,n.jsx)(h.L3,{children:c("plugins.pluginSort")})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-0",children:[(0,n.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:c("plugins.pluginSortDescription")}),(0,n.jsx)(A.Mp,{sensors:v,collisionDetection:A.fp,onDragEnd:function(e){let{active:s,over:t}=e;console.log("Drag end event:",{active:s,over:t}),t&&s.id!==t.id&&x(e=>{let n=e.findIndex(e=>"".concat(e.author,"-").concat(e.name)===s.id),i=e.findIndex(e=>"".concat(e.author,"-").concat(e.name)===t.id);return(0,V.be)(e,n,i)})},children:(0,n.jsx)(V.gB,{items:u.map(e=>"".concat(e.author,"-").concat(e.name)),strategy:V._G,children:u.map(e=>(0,n.jsx)(B,{plugin:e},"".concat(e.author,"-").concat(e.name)))})})]}),(0,n.jsxs)(h.Es,{className:"px-6 py-4",children:[(0,n.jsx)(m.$,{variant:"outline",onClick:()=>t(!1),disabled:g,children:c("common.cancel")}),(0,n.jsx)(m.$,{onClick:function(){f(!0);let e=u.map((e,s)=>({author:e.author,name:e.name,priority:s}));a.ok.reorderPlugins(e).then(()=>{o.oR.success(c("plugins.pluginSortSuccess")),r(),t(!1)}).catch(e=>{o.oR.error(c("plugins.pluginSortError")+e.message)}).finally(()=>{f(!1)})},disabled:g,children:g?c("common.saving"):c("common.save")})]})]})})}var U=t(7313),H=t(4616),$=t(9099),W=function(e){return e.WAIT_INPUT="wait_input",e.INSTALLING="installing",e.ERROR="error",e}(W||{});function D(){let{t:e}=(0,d.Bd)(),[s,t]=(0,i.useState)(!1),[l,r]=(0,i.useState)(!1),[c,u]=(0,i.useState)("wait_input"),[x,p]=(0,i.useState)(null),[g,f]=(0,i.useState)(""),v=(0,i.useRef)(null);return(0,n.jsxs)("div",{className:j().pageContainer,children:[(0,n.jsxs)(U.tU,{defaultValue:"installed",className:"w-full",children:[(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center px-[0.8rem]",children:[(0,n.jsxs)(U.j7,{className:"shadow-md py-5 bg-[#f0f0f0]",children:[(0,n.jsx)(U.Xi,{value:"installed",className:"px-6 py-4 cursor-pointer",children:e("plugins.installed")}),(0,n.jsx)(U.Xi,{value:"market",className:"px-6 py-4 cursor-pointer",children:e("plugins.marketplace")})]}),(0,n.jsxs)("div",{className:"flex flex-row justify-end items-center",children:[(0,n.jsx)(m.$,{variant:"outline",className:"px-6 py-4 cursor-pointer mr-2",onClick:()=>{r(!0)},children:e("plugins.arrange")}),(0,n.jsxs)(m.$,{variant:"default",className:"px-6 py-4 cursor-pointer",onClick:()=>{t(!0),u("wait_input"),p(null)},children:[(0,n.jsx)(H.A,{className:"w-4 h-4"}),e("plugins.install")]})]})]}),(0,n.jsx)(U.av,{value:"installed",children:(0,n.jsx)(C,{ref:v})}),(0,n.jsx)(U.av,{value:"market",children:(0,n.jsx)(T,{askInstallPlugin:e=>{f(e),t(!0),u("wait_input"),p(null)}})})]}),(0,n.jsx)(h.lG,{open:s,onOpenChange:t,children:(0,n.jsxs)(h.Cf,{className:"w-[500px] p-6",children:[(0,n.jsx)(h.c7,{children:(0,n.jsxs)(h.L3,{className:"flex items-center gap-4",children:[(0,n.jsx)($.A,{className:"size-6"}),(0,n.jsx)("span",{children:e("plugins.installFromGithub")})]})}),"wait_input"===c&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("p",{className:"mb-2",children:e("plugins.onlySupportGithub")}),(0,n.jsx)(w.p,{placeholder:e("plugins.enterGithubLink"),value:g,onChange:e=>f(e.target.value),className:"mb-4"})]}),"installing"===c&&(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)("p",{className:"mb-2",children:e("plugins.installing")})}),"error"===c&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("p",{className:"mb-2",children:e("plugins.installFailed")}),(0,n.jsx)("p",{className:"mb-2 text-red-500",children:x})]}),(0,n.jsxs)(h.Es,{children:["wait_input"===c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.$,{variant:"outline",onClick:()=>t(!1),children:e("common.cancel")}),(0,n.jsx)(m.$,{onClick:function(){var s;s=g,u("installing"),a.ok.installPluginFromGithub(s).then(s=>{let n=s.task_id,i=!1;console.log("taskId:",n);let l=setInterval(()=>{a.ok.getAsyncTask(n).then(s=>{if(console.log("task status:",s),s.runtime.done){if(clearInterval(l),s.runtime.exception)p(s.runtime.exception),u("error");else{var n;i||(o.oR.success(e("plugins.installSuccess")),i=!0),f(""),t(!1),null===(n=v.current)||void 0===n||n.refreshPluginList()}}})},1e3)}).catch(e=>{console.log("error when install plugin:",e),p(e.message),u("error")})},children:e("common.confirm")})]}),"error"===c&&(0,n.jsx)(m.$,{variant:"default",onClick:()=>t(!1),children:e("common.close")})]})]})}),(0,n.jsx)(G,{open:l,onOpenChange:r,onSortComplete:()=>{var e;null===(e=v.current)||void 0===e||e.refreshPluginList()}})]})}},7313:(e,s,t)=>{"use strict";t.d(s,{Xi:()=>c,av:()=>o,j7:()=>r,tU:()=>a});var n=t(5155);t(2115);var i=t(64),l=t(9434);function a(e){let{className:s,...t}=e;return(0,n.jsx)(i.bL,{"data-slot":"tabs",className:(0,l.cn)("flex flex-col gap-2",s),...t})}function r(e){let{className:s,...t}=e;return(0,n.jsx)(i.B8,{"data-slot":"tabs-list",className:(0,l.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...t})}function c(e){let{className:s,...t}=e;return(0,n.jsx)(i.l9,{"data-slot":"tabs-trigger",className:(0,l.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...t})}function o(e){let{className:s,...t}=e;return(0,n.jsx)(i.UC,{"data-slot":"tabs-content",className:(0,l.cn)("flex-1 outline-none",s),...t})}}},e=>{var s=s=>e(e.s=s);e.O(0,[681,218,464,352,671,994,211,726,982,646,334,554,977,441,684,358],()=>s(5296)),_N_E=e.O()}]);